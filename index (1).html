<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì„ ì ìˆ˜íŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-100 text-gray-900">
<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-4">ê²Œì„ ì ìˆ˜íŒ</h1>
    <div class="flex" style="font-size:24px" > 
        <input  type="text" id="gameName" class="w-full p-2 border rounded text-center" placeholder="ê²Œì„ ì´ë¦„ ì…ë ¥"> 
        <input type="text" id="gameTime" class="w-full p-2 border rounded text-center" placeholder="MM:SS" value="10:00">  
        <button id="startStopButton" onclick="toggleStopwatch()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" style="font-size:12px">ì‹œì‘</button> 
    </div>
    <div id="teamsContainer" class="flex flex-wrap mt-4"></div> 
    <div class="text-center mt-4">
        <button onclick="addTeamCard()" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">íŒ€ ì¶”ê°€</button>
        <button onclick="saveGameData()" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">ê²Œì„ì €ì¥</button>
        <button onclick="loadGameData()" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded">ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
</div>
  <footer style="margin-top:50px;" class="text-center text-gray-800 dark:text-white ">
    ğŸ¦¾Â©2024<a href="https://www.youtube.com/channel/UCLP2jMz-MpVgsGizdjfQDZA" target="_blank"
      style="font-weight: 900;"> RunBuilder</a>
  </footer>

<script>
let teamCount = 0;
let stopwatchInterval;
let currentTime = "10:00"; // ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
let isStopwatchRunning = false; // ìŠ¤í†±ì›Œì¹˜ ì‹¤í–‰ ìƒíƒœë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜

function modifyScore(teamId, amount) {
    const scoreElement = document.getElementById(`team${teamId}Score`);
    let score = parseInt(scoreElement.innerText);
    score += amount;
    scoreElement.innerText = score.toString();
}


function addTeamCard() {
    teamCount++;
    const teamCard = document.createElement('div');
    teamCard.className = "p-4 bg-white shadow-md rounded-lg text-center m-2 flex-auto";
    teamCard.id = `teamCard${teamCount}`;
    teamCard.innerHTML = `
        <h2 class="text-xl font-semibold mb-2">íŒ€ ${teamCount}</h2>
        <input type="text" id="team${teamCount}Name" class="text-center mb-2" placeholder="íŒ€ ì´ë¦„ ì…ë ¥">
        <div class="flex justify-center gap-2 mb-2">
            <button onclick="modifyScore(${teamCount}, 1)" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">ì ìˆ˜ ì¦ê°€</button>
            <button onclick="modifyScore(${teamCount}, -1)" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">ì ìˆ˜ ê°ì†Œ</button>
            <button onclick="deleteTeamCard(${teamCount})" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">íŒ€ ì‚­ì œ</button>
        </div>
        <p id="team${teamCount}Score" class="text-2xl font-bold">0</p>
    `;
    document.getElementById('teamsContainer').appendChild(teamCard);
}

function deleteTeamCard(teamId) {
    const teamCard = document.getElementById(`teamCard${teamId}`);
    teamCard.remove();
}

function saveGameData() {
    const gameData = {
        gameName: document.getElementById('gameName').value,
        gameTime: currentTime,
        teams: Array.from(document.querySelectorAll('[id^="teamCard"]')).map((teamCard, index) => {
            const teamId = index + 1;
            return {
                name: document.getElementById(`team${teamId}Name`).value,
                score: document.getElementById(`team${teamId}Score`).innerText
            };
        })
    };
    const saveKey = `Game-${gameData.gameName}-${Date.now()}`;
    localStorage.setItem(saveKey, JSON.stringify(gameData));
    Swal.fire('ì €ì¥ ì„±ê³µ!', 'ê²Œì„ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
}

function loadGameData() {
    // ì €ì¥ëœ ëª¨ë“  í‚¤ë¥¼ ë¶ˆëŸ¬ì˜¤ë˜, 'Game-'ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.
    const keys = Object.keys(localStorage).filter(key => key.startsWith("Game-"));
    const options = keys.reduce((acc, key) => {
        // í‚¤ì—ì„œ ë‚ ì§œì™€ ê²Œì„ ì´ë¦„ë§Œ ì¶”ì¶œí•©ë‹ˆë‹¤.
        const [, gameName, timestamp] = key.split('-');
        const date = new Date(parseInt(timestamp)).toLocaleString();
        acc[key] = `${gameName} (${date})`;
        return acc;
    }, {});

    if (Object.keys(options).length === 0) {
        Swal.fire('ì €ì¥ëœ ê²Œì„ ì—†ìŒ', 'ì €ì¥ëœ ê²Œì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'info');
        return;
    }

    Swal.fire({
        title: 'ì €ì¥ëœ ê²Œì„ ì„ íƒ',
        input: 'select',
        inputOptions: options,
        inputPlaceholder: 'ê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”',
        showCancelButton: true,
    }).then((result) => {
        if (result.value) {
            const data = JSON.parse(localStorage.getItem(result.value));
            document.getElementById('gameName').value = data.gameName;
            document.getElementById('gameTime').value = data.gameTime;
            const teamsContainer = document.getElementById('teamsContainer');
            teamsContainer.innerHTML = '';
            teamCount = 0; // Reset teamCount before adding new cards
            data.teams.forEach((team, index) => {
                addTeamCard();
                const currentTeamId = teamCount; // Use the current teamCount as ID
                document.getElementById(`team${currentTeamId}Name`).value = team.name;
                document.getElementById(`team${currentTeamId}Score`).innerText = team.score;
            });
        }
    });
}

function showCurrentTime() {
    Swal.fire({
        title: 'í˜„ì¬ ê²½ê¸° ì‹œê°„',
        html: `<h2 class="text-3xl font-bold">${currentTime}</h2>`,
        icon: 'info',
        confirmButtonText: 'í™•ì¸'
    });
}

function toggleStopwatch() {
    const startStopButton = document.getElementById("startStopButton");
    if (isStopwatchRunning) {
        stopStopwatch();
        startStopButton.innerText = "ì‹œì‘"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ 'ì‹œì‘'ìœ¼ë¡œ ë³€ê²½
        document.getElementById('gameTime').value = "10:00"; // ìŠ¤í†±ì›Œì¹˜ ì‹œê°„ì„ ì´ˆê¸°í™”
        isStopwatchRunning = false;
    } else {
        startStopwatch();
        startStopButton.innerText = "ì¤‘ì§€"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ë¥¼ 'ì¤‘ì§€'ë¡œ ë³€ê²½
        isStopwatchRunning = true;
    }
}

function startStopwatch() {
    let time = document.getElementById('gameTime').value.split(':');
    let totalTime = parseInt(time[0]) * 60 + parseInt(time[1]);
    clearInterval(stopwatchInterval); // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ íƒ€ì´ë¨¸ê°€ ìˆë‹¤ë©´ ì¤‘ì§€
    stopwatchInterval = setInterval(() => {
        totalTime--;
        let minutes = Math.floor(totalTime / 60);
        let seconds = totalTime % 60;
        currentTime = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
        document.getElementById('gameTime').value = currentTime;
        if (totalTime <= 0) {
            clearInterval(stopwatchInterval);
            document.getElementById('gameTime').value = "10:00"; // ì‹œê°„ ì¢…ë£Œ ì‹œ ì´ˆê¸°í™”
            document.getElementById("startStopButton").innerText = "ì‹œì‘";
            isStopwatchRunning = false;
            Swal.fire('ì‹œê°„ ì¢…ë£Œ!', 'ê²½ê¸° ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
    }, 1000);
}

function stopStopwatch() {
    clearInterval(stopwatchInterval); // íƒ€ì´ë¨¸ ì¤‘ì§€
}

window.onload = function() {
    addTeamCard(); // Add first team card on load
    addTeamCard(); // Add second team card on load
};
</script>
</body>
</html>
